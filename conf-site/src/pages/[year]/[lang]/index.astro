---
import { getCollection } from "astro:content";
import Layout from "../../../layouts/Layout.astro";
import ImportantDates from "../../../components/ImportantDates.astro";
import NoticeBoard from "../../../components/NoticeBoard.astro";

export async function getStaticPaths() {
  const conferences = await getCollection("conference");
  return conferences.map((conf) => ({
    params: { year: String(conf.data.year), lang: String(conf.data.lang) },
    props: { data: conf.data },
  }));
}

const { data } = Astro.props;
const {
  year,
  lang,
  meta,
  menu,
  hero,
  importantDates,
  notice = [],
  committee,
  footer,
} = data;

const base = import.meta.env.BASE_URL;
const getUrl = (path: string) => {
  const cleanPath = path.startsWith("/") ? path.slice(1) : path;
  const normalizedBase = base.endsWith("/") ? base : base + "/";
  return `${normalizedBase}${cleanPath}`;
};
---

<Layout title={meta.title} lang={lang} year={year} menuLabels={menu}>
  <!-- Hero Section -->
  <section
    class="relative bg-gray-900 text-white py-20 lg:py-32 overflow-hidden"
  >
    <div class="absolute inset-0 z-0">
      {
        hero.bgImage ? (
          <img
            src={hero.bgImage}
            alt="Conference Hero"
            class="w-full h-full object-cover"
          />
        ) : (
          <div class="w-full h-full bg-gradient-to-r from-[#003366] to-blue-900" />
        )
      }
      <div class="absolute inset-0 bg-[#003366] mix-blend-multiply opacity-60">
      </div>
      <div
        class="absolute inset-0 bg-gradient-to-t from-[#003366] via-transparent to-transparent opacity-80"
      >
      </div>
    </div>
    <div
      class="relative z-10 max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center"
    >
      <h1 class="text-4xl md:text-6xl font-bold mb-4 tracking-tight">
        {hero.title}
      </h1>
      <p class="text-xl md:text-2xl text-blue-100 mb-8 font-light">
        {hero.subtitle}
      </p>

      <div
        class="flex flex-col md:flex-row justify-center items-center space-y-4 md:space-y-0 md:space-x-8 mb-12 text-lg"
      >
        <div class="flex items-center">
          <svg
            class="w-6 h-6 mr-2"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
            ><path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"
            ></path></svg
          >
          {hero.date}
        </div>
        <div class="flex items-center">
          <svg
            class="w-6 h-6 mr-2"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
            ><path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"
            ></path><path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"></path></svg
          >
          {hero.location}
        </div>
      </div>

      <a
        href={getUrl(`${year}/${lang}/${hero.ctaLink}`)}
        class="inline-block bg-white text-[#003366] font-bold py-3 px-8 rounded-full hover:bg-blue-50 transition-colors shadow-lg transform hover:-translate-y-1"
      >
        {hero.cta}
      </a>
    </div>
  </section>

  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12">
    <div class="grid grid-cols-1 lg:grid-cols-3 gap-12">
      <!-- Main Content Area -->
      <div class="lg:col-span-2 space-y-12">
        <!-- Notice Section -->
        <section>
          <NoticeBoard
            notices={notice}
            title={lang === "ko" ? "공지사항" : "News & Notice"}
          />
        </section>

        <section id="about">
          <h2
            class="text-3xl font-bold text-gray-900 mb-6 border-b-2 border-blue-900 pb-2 inline-block"
          >
            {lang === "ko" ? "컨퍼런스 소개" : "About Conference"}
          </h2>
          <div
            class="prose prose-blue max-w-none text-lg text-gray-700 leading-relaxed"
          >
            <p>{meta.description}</p>
            <p class="mt-4">
              {
                lang === "ko"
                  ? "본 컨퍼런스는 멀티미디어 정보 기술 및 응용 분야의 최신 연구 성과를 공유하고 국내외 전문가들의 네트워킹을 위한 장입니다."
                  : "This conference is a premier forum for sharing latest research results in multimedia information technology and applications and networking with international experts."
              }
            </p>
            <div class="mt-6">
              <a
                href={getUrl(`${year}/${lang}/call-for-papers`)}
                class="text-blue-700 font-bold hover:underline flex items-center"
              >
                {
                  lang === "ko"
                    ? "논문 모집 분야 확인하기"
                    : "View Technical Scope & Call for Papers"
                }
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  class="h-5 w-5 ml-1"
                  fill="none"
                  viewBox="0 0 24 24"
                  stroke="currentColor"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M9 5l7 7-7 7"></path>
                </svg>
              </a>
            </div>
          </div>
        </section>

        <section id="poster">
          <h2
            class="text-3xl font-bold text-gray-900 mb-6 border-b-2 border-blue-900 pb-2 inline-block"
          >
            {lang === "ko" ? "컨퍼런스 포스터" : "Conference Poster"}
          </h2>
          <div
            class="bg-gray-50 p-4 rounded-xl shadow-inner flex justify-center"
          >
            <img
              src="https://lh3.googleusercontent.com/sitesv/AAzXCkdpW58rrxHIgQ1DPIXT8glNMjJ5jBYpGrkpG89YyP4DDn223X8zOdAKtJHzKdisoq3qCZsmwmPsr9Q1D2XmRVwCbxArMVxXUpMhuhHEtoRY_n0CPV4fIyo7Tpaqg8Xc9p5GsQAqq7MN2VDJ5iObeRyfJlNgw9QufNAlhyrWW7Ts62xqhDGu9NQzR3ZC5suSjHQzZYQDLHOrUWOfwpu5kPZQ18f2XU9LHEeHG_0=w1280"
              alt="MITA 2025 Poster"
              class="rounded-lg shadow-2xl max-w-full h-auto cursor-zoom-in hover:scale-[1.01] transition-transform duration-300"
            />
          </div>
        </section>
        <section id="committee">
          <h2
            class="text-3xl font-bold text-gray-900 mb-6 border-b-2 border-blue-900 pb-2 inline-block"
          >
            Committee Members
          </h2>
          <div class="grid grid-cols-1 sm:grid-cols-2 gap-6">
            {
              committee.map((member) => (
                <div class="flex items-center space-x-4 bg-white p-4 rounded-lg shadow border border-gray-100">
                  <div class="w-16 h-16 bg-gray-200 rounded-full flex-shrink-0 overflow-hidden">
                    {member.image ? (
                      <img
                        src={member.image}
                        alt={member.name}
                        class="w-full h-full object-cover"
                      />
                    ) : (
                      <div class="w-full h-full flex items-center justify-center text-gray-400">
                        <svg
                          class="w-8 h-8"
                          fill="currentColor"
                          viewBox="0 0 20 20"
                        >
                          <path
                            fill-rule="evenodd"
                            d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z"
                            clip-rule="evenodd"
                          />
                        </svg>
                      </div>
                    )}
                  </div>
                  <div>
                    <h3 class="font-bold text-lg text-gray-900">
                      {member.name}
                    </h3>
                    <p class="text-blue-700 font-medium text-sm">
                      {member.role}
                    </p>
                    <p class="text-gray-500 text-sm">{member.affiliation}</p>
                  </div>
                </div>
              ))
            }
          </div>
        </section>
      </div>

      <!-- Sidebar -->
      <div class="lg:col-span-1">
        <div class="sticky top-24 space-y-8">
          <ImportantDates
            dates={importantDates}
            title={lang === "ko" ? "주요 일정" : "Important Dates"}
          />

          <!-- Partners & Publication -->
          <div class="bg-gray-50 p-6 rounded-lg border border-gray-200">
            <h3 class="font-bold text-gray-900 mb-4">
              {lang === "ko" ? "협력 기관 및 출판" : "Partners & Publication"}
            </h3>
            <div class="space-y-6">
              <div
                class="bg-white p-4 rounded shadow-sm border border-gray-100 flex items-center justify-center"
              >
                <img
                  src="https://lh3.googleusercontent.com/sitesv/AAzXCkc6PJvj0_gUbp_11HE8qOgUUyYBJgYDk3sE99cHAuuHUhmNVHXNKcEA37OEDtjy8ZSlfQIft0jHTaFVMbaDjhpbkz6ppoj7O0w3a1gXtTQbYzGy4jL48rXT2A1atZX4ogrRBE8u4mbXdjKIUallNTdvy88gzHiALFQN2EiWA6MAqYe23aB8a1Maj1uord_yyi1Cd9BXRkG8B9NZj2LVc4I3WsX-qepfK24aTIg=w1280"
                  alt="Springer CCIS"
                  class="max-h-16 h-auto"
                />
              </div>
              <div class="text-center text-xs text-gray-500 italic">
                {
                  lang === "ko"
                    ? "채택된 논문은 Springer CCIS 시리즈로 출판됩니다."
                    : "Accepted papers will be published in Springer CCIS series."
                }
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div slot="footer-content">
    <p class="mb-2">{footer.copyright}</p>
    <p class="text-sm text-gray-500">{footer.contact}</p>
  </div>
</Layout>

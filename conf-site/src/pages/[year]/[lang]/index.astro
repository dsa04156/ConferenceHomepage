---
import { getCollection } from "astro:content";
import Layout from "../../../layouts/Layout.astro";
import ImportantDates from "../../../components/ImportantDates.astro";
import NoticeBoard from "../../../components/NoticeBoard.astro";
import Sponsors from "../../../components/Sponsors.astro";

export async function getStaticPaths() {
  const conferences = await getCollection("conference");
  const enConferences = conferences.filter((conf) => conf.data.lang === "en");
  return enConferences.map((conf) => ({
    params: { year: String(conf.data.year), lang: String(conf.data.lang) },
    props: { data: conf.data },
  }));
}

const { data } = Astro.props;
const {
  year,
  lang,
  meta,
  menu,
  hero,
  posterImage,
  partners = [],
  importantDates,
  notice = [],
  committee,
  footer,
} = data;

const featuredCommittee = committee.filter((member) => {
  const roles = new Set([
    "General Chair",
    "Organizing Committee Co-Chairs",
    "Program Committee Co-Chair",
    "CCMS Organizing Committee Co-Chairs",
  ]);
  const memberRoles = member.role
    .split(",")
    .map((role) => role.trim())
    .filter(Boolean);
  return memberRoles.some((role) => roles.has(role));
});

const base = import.meta.env.BASE_URL;
const getUrl = (path: string) => {
  if (!path) return "";
  if (path.startsWith("http")) return path;

  const normalizedBase = base.endsWith("/") ? base : base + "/";
  // Remove leading slash from path to avoid double slashes when joining with normalizedBase
  const cleanPath = path.startsWith("/") ? path.slice(1) : path;

  // If the clean path already starts with the base name (excluding leading/trailing slashes),
  // we need to be careful not to double-prefix.
  // But usually, base is like "/ConferenceHomepage/" and cleanPath is "images/..."
  return `${normalizedBase}${cleanPath}`;
};
---

<Layout title={meta.title} lang={lang} year={year} menuLabels={menu}>
  <!-- Hero Section -->
  <section
    class="relative bg-gray-900 text-white py-20 lg:py-32 overflow-hidden"
  >
    <div class="absolute inset-0 z-0">
      {
        hero.bgImage ? (
          <img
            src={getUrl(hero.bgImage)}
            alt="Conference Hero"
            class="w-full h-full object-cover"
          />
        ) : (
          <div class="w-full h-full bg-gradient-to-r from-[#003366] to-blue-900" />
        )
      }
      <div class="absolute inset-0 bg-[#003366] mix-blend-multiply opacity-60">
      </div>
      <div
        class="absolute inset-0 bg-gradient-to-t from-[#003366] via-transparent to-transparent opacity-80"
      >
      </div>
    </div>
    <div class="relative z-10 max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <div
        class="bg-black/50 backdrop-blur-sm p-8 md:p-12 rounded-xl max-w-2xl border border-white/10 shadow-2xl"
      >
        <h1
          class="text-4xl md:text-5xl lg:text-6xl font-extrabold mb-4 tracking-tight leading-tight"
        >
          {hero.title}
        </h1>
        <p
          class="text-lg md:text-xl text-blue-100 mb-8 font-light leading-relaxed"
        >
          {hero.subtitle}
        </p>

        <div class="flex flex-col space-y-4 mb-10 text-base md:text-lg">
          <div class="flex items-center text-white/90">
            <svg
              class="w-5 h-5 mr-3 text-blue-400"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
              ><path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"
              ></path></svg
            >
            <span class="font-medium">{hero.date}</span>
          </div>
          <div class="flex items-center text-white/90">
            <svg
              class="w-5 h-5 mr-3 text-blue-400"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
              ><path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"
              ></path><path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"></path></svg
            >
            <span class="font-medium">{hero.location}</span>
          </div>
        </div>

        <a
          href={getUrl(`${year}/${lang}/${hero.ctaLink}`)}
          class="inline-flex items-center bg-blue-600 text-white font-bold py-3.5 px-8 rounded-lg hover:bg-blue-700 transition-all shadow-xl transform hover:-translate-y-1 active:translate-y-0"
        >
          {hero.cta}
          <svg
            xmlns="http://www.w3.org/2000/svg"
            class="h-5 w-5 ml-2"
            fill="none"
            viewBox="0 0 24 24"
            stroke="currentColor"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M14 5l7 7-7 7"></path>
          </svg>
        </a>
      </div>
    </div>
  </section>

  <!-- Quick Links Section -->
  <div class="bg-gray-50 border-b border-gray-100">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-10">
      <div class="grid grid-cols-2 md:grid-cols-4 gap-4 md:gap-6">
        {
          [
            {
              key: "call-for-papers",
              icon: "M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z",
            },
            {
              key: "committee",
              icon: "M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z",
            },
            {
              key: "submission",
              icon: "M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12",
            },
            {
              key: "venue-hotel",
              icon: "M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4",
            },
          ].map((link) => (
            <a
              href={getUrl(`${year}/${lang}/${link.key}`)}
              class="flex flex-col items-center justify-center p-6 bg-[#1D3557] rounded-xl shadow-lg hover:bg-[#003366] transition-all transform hover:-translate-y-2 group text-center"
            >
              <div class="w-12 h-12 bg-white/10 rounded-full flex items-center justify-center mb-4 group-hover:scale-110 transition-transform">
                <svg
                  class="w-6 h-6 text-white"
                  fill="none"
                  stroke="currentColor"
                  viewBox="0 0 24 24"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d={link.icon}
                  />
                </svg>
              </div>
              <span class="text-white font-bold uppercase tracking-wider text-sm">
                {(menu && menu[link.key.replace(/-/g, "_")]) || link.key}
              </span>
            </a>
          ))
        }
      </div>
    </div>
  </div>

  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12">
    <div class="grid grid-cols-1 lg:grid-cols-3 gap-12">
      <!-- Main Content Area -->
      <div class="lg:col-span-2 space-y-12 order-2 lg:order-1">
        <!-- Notice Section -->
        <section>
          <NoticeBoard notices={notice} title="News & Notice" />
        </section>

        <section id="about">
          <h2
            class="text-3xl font-bold text-gray-900 mb-6 border-b-2 border-blue-900 pb-2 inline-block"
          >
            About Conference
          </h2>
          <div
            class="prose prose-blue max-w-none text-lg text-gray-700 leading-relaxed"
          >
            <p>{meta.description}</p>
            <p class="mt-4">
              MITA attracts well over 150 submissions and 200 participants each
              year, serving as the prime forum for the dissemination of
              knowledge in the multimedia and information field. MITA 2025 will
              showcase high-quality oral and poster presentations sponsored by
              the Korea Multimedia Society (KMMS). Researchers, developers, and
              practitioners are welcomed to submit any new or emerging results
              of multimedia technology and intelligent IoT systems. In MITA
              2025, exceptional papers and contributors will be recognized with
              prestigious awards. Original research papers on all aspects of
              the theories and applications of multimedia information
              technology are solicited for submission to MITA 2025, which is
              organized and sponsored by the Korea Multimedia Society (KMMS).
            </p>
            <div class="mt-6">
              <a
                href={getUrl(`${year}/${lang}/call-for-papers`)}
                class="text-blue-700 font-bold hover:underline flex items-center"
              >
                View Technical Scope & Call for Papers
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  class="h-5 w-5 ml-1"
                  fill="none"
                  viewBox="0 0 24 24"
                  stroke="currentColor"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M9 5l7 7-7 7"></path>
                </svg>
              </a>
            </div>
          </div>
        </section>

        {
          posterImage && (
            <section id="poster">
              <h2 class="text-3xl font-bold text-gray-900 mb-6 border-b-2 border-blue-900 pb-2 inline-block">
                Conference Poster
              </h2>
              <div class="bg-gray-50 p-4 rounded-xl shadow-inner flex justify-center">
                <img
                  src={getUrl(posterImage)}
                  alt={`${year} Conference Poster`}
                  class="rounded-lg shadow-2xl max-w-full h-auto cursor-zoom-in hover:scale-[1.01] transition-transform duration-300"
                />
              </div>
            </section>
          )
        }
        <section id="committee">
          <h2
            class="text-3xl font-bold text-gray-900 mb-6 border-b-2 border-blue-900 pb-2 inline-block"
          >
            Committee Members
          </h2>
          <div class="grid grid-cols-1 sm:grid-cols-2 gap-6">
            {
              featuredCommittee.map((member) => (
                <div class="flex items-center space-x-4 bg-white p-4 rounded-lg shadow border border-gray-100">
                  <div class="w-16 h-16 bg-gray-200 rounded-full flex-shrink-0 overflow-hidden">
                    {member.image ? (
                      <img
                        src={getUrl(member.image)}
                        alt={member.name}
                        class="w-full h-full object-cover"
                      />
                    ) : (
                      <div class="w-full h-full flex items-center justify-center text-gray-400">
                        <svg
                          class="w-8 h-8"
                          fill="currentColor"
                          viewBox="0 0 20 20"
                        >
                          <path
                            fill-rule="evenodd"
                            d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z"
                            clip-rule="evenodd"
                          />
                        </svg>
                      </div>
                    )}
                  </div>
                  <div>
                    <h3 class="font-bold text-lg text-gray-900">
                      {member.name}
                    </h3>
                    <p class="text-blue-700 font-medium text-sm">
                      {member.role}
                    </p>
                    <p class="text-gray-500 text-sm">{member.affiliation}</p>
                  </div>
                </div>
              ))
            }
          </div>
          <div class="mt-6">
            <a
              href={getUrl(`${year}/${lang}/committee`)}
              class="text-blue-700 font-bold hover:underline flex items-center"
            >
              View Full Committee
              <svg
                xmlns="http://www.w3.org/2000/svg"
                class="h-5 w-5 ml-1"
                fill="none"
                viewBox="0 0 24 24"
                stroke="currentColor"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M9 5l7 7-7 7"></path>
              </svg>
            </a>
          </div>
        </section>
      </div>

      <!-- Sidebar -->
      <div class="lg:col-span-1 self-start order-1 lg:order-2">
        <div class="sticky top-24 space-y-8 h-fit">
          <ImportantDates dates={importantDates} title="Important Dates" />
          <Sponsors partners={partners} />
        </div>
      </div>
    </div>
  </div>

  <div slot="footer-content">
    <p class="mb-2">{footer.copyright}</p>
    <p class="text-sm text-gray-500">{footer.contact}</p>
  </div>
</Layout>
